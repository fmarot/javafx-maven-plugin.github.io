<link rel="import" href="polymer.html">

<script type="text/javascript" src="../js/prism.js"></script>

<dom-module id="configuration-output">
    <template>
        <pre class="language-markup" id="output"><code></code></pre>
        <p>You should run this on you command-line: <code id="callCommand"></code></p>
    </template>

    <script>
        Polymer({
            is: "configuration-output",
            properties:{
                configuration: Object,
                version: String,
                mavenProperties: Object,
                command: String
            },
            attached: function(){
                this.refreshCode();
            },
            hasDefaultValue: function(someEntry){
                console.log("hasDefaultValue", someEntry);
                return someEntry.defaultValue === someEntry.value;
            }
            , observers:[
                // information about polymer:
                // - don't use this naming for function-names: "*Changed"
                // - properties to be watched have to be "lower-cased"
                "doRefreshStuffWhenSomethingChanged(mavenproperties.*)"
                , "doRefreshStuffWhenSomethingChanged(configuration.*)"
            ],
            doRefreshStuffWhenSomethingChanged: function(event){
                this.refreshCode();
            },
            refreshCode: function(){
                var self = this;
                function getStringValueTag(tagName, value){
                    return "&lt;" + tagName + "&gt;" + value + "&lt;" + "/" + tagName + "&gt;";
                }
                function getBooleanValueTag(tagName, value){
                    return getStringValueTag(tagName, (!!value)?"true":"false");
                }
                function wrapperWithinPluginCode(configurationString){
                    var rows = [
                        getStringValueTag("groupId", "com.zenjava")
                        , getStringValueTag("artifactId", "javafx-maven-plugin")
                        , getStringValueTag("version", self.version)
                        , getStringValueTag("configuration", "\n" + addIndentation(configurationString) + "\n")
                    ];
                    // check CLI/lifecycle-style
                    if(self.configuration.selectedBuildMechanism !== "cli"){
                        var jarExecutionRows = [];
                        if(self.configuration.selectedLifecycle === "build-jar" || self.configuration.selectedLifecycle === "build-native" || self.configuration.selectedLifecycle === "build-web"){
                            // native
                            if( self.configuration.selectedLifecycle === "build-native" ){
                                jarExecutionRows[jarExecutionRows.length] = "&lt;"+ "!-- required before build-native --" +"&gt;";
                            }
                            // web
                            if( self.configuration.selectedLifecycle === "build-web" ){
                                jarExecutionRows[jarExecutionRows.length] = "&lt;"+ "!-- required before build-web --" +"&gt;";
                            }
                            jarExecutionRows[jarExecutionRows.length] = getStringValueTag("id", "create-jfxjar");
                            jarExecutionRows[jarExecutionRows.length] = getStringValueTag("phase", "package");
                            jarExecutionRows[jarExecutionRows.length] = getStringValueTag("goals", "\n" + 
                                    addIndentation( getStringValueTag("goal", "build-jar") )
                                + "\n");
                            var executionRows = [];
                            var jarExecution = getStringValueTag("execution", "\n"+addIndentation( jarExecutionRows.join("\n") ) +"\n");
                            var nativeExecution = "";
                            executionRows[executionRows.length] = jarExecution;

                            // native
                            if(self.configuration.selectedLifecycle === "build-native"){
                                var nativeExecutionRows = [];
                                nativeExecutionRows[nativeExecutionRows.length] = getStringValueTag("id", "create-native");
                                nativeExecutionRows[nativeExecutionRows.length] = getStringValueTag("phase", "package");
                                nativeExecutionRows[nativeExecutionRows.length] = getStringValueTag("goals", "\n" + 
                                        addIndentation( getStringValueTag("goal", "build-native") )
                                    + "\n");
                                nativeExecution = getStringValueTag("execution", "\n"+addIndentation( nativeExecutionRows.join("\n") ) +"\n");
                                executionRows[executionRows.length] = nativeExecution;
                            }
                            // web
                            if(self.configuration.selectedLifecycle === "build-web"){
                                var webExecutionRows = [];
                                webExecutionRows[webExecutionRows.length] = getStringValueTag("id", "create-web");
                                webExecutionRows[webExecutionRows.length] = getStringValueTag("phase", "package");
                                webExecutionRows[webExecutionRows.length] = getStringValueTag("goals", "\n" + 
                                        addIndentation( getStringValueTag("goal", "build-web") )
                                    + "\n");
                                webExecutionRows = getStringValueTag("execution", "\n"+addIndentation( webExecutionRows.join("\n") ) +"\n");
                                executionRows[executionRows.length] = webExecutionRows;
                            }
                            
                            rows[rows.length] = getStringValueTag("executions", "\n" + 
                                        addIndentation( executionRows.join("\n" ) )
                                    + "\n");
                        }
                    }
                    return rows.join("\n");
                }
                function getFullPluginConfigurationCode(){
                    var configurationCode = wrapperWithinPluginCode("TODO");
                    return getStringValueTag("plugin", "\n" + addIndentation( configurationCode) + "\n");
                }
                function addIndentation(content){
                    var rowResult = content.split("\n").join("\n\t");
                    return "\t" + rowResult;
                }
                Polymer.dom(this.$.output).innerHTML = getFullPluginConfigurationCode();
                Prism.highlightElement(this.$.output);
                
                var command = "mvn ";
                if(this.configuration.selectedBuildMechanism === "cli"){
                    command += "jfx:" + this.configuration.selectedGoal;
                }

                if(this.configuration.selectedBuildMechanism === "lifecycle"){
                    command += "package";
                }

                this.$.callCommand.innerHTML = command;
                Prism.highlightElement(this.$.callCommand);
            }
        });
    </script>
</dom-module>
